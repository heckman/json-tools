#!/usr/bin/env zsh
# Copyright 2024 Erik Ben Heckman <erik@heckman.ca>
# SPDX-License-Identifier: MIT


# json-env v0.3


# generate json from ENV vars
#
# usage: json-env [pattern]
#
# writes environment variables to stdout as json
# if pattern is specified, only variables matching it will be included
#

help() { awk '/^ *[^#]/{exit}NR>1{print substr($0,2)}' $ZSH_ARGZERO; }
version() { awk '$0~'"${(qqq)ZSH_ARGZERO:A:t}"'{print substr($0,2);exit}' $ZSH_ARGZERO; }

case ${1:-} in
	-h|--help) help; exit ;;
	-v|--version) version; exit ;;
	--)
		shift ;;
esac

jq -n '
	env | with_entries (
		if .key | test("'$1'")
		then {key: .key, value: .value}
		else empty
		end
	)
'
